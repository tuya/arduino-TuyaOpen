# 音频录制示例

## 概述
此示例演示如何使用涂鸦音频库通过按钮控制进行音频录制和回放，并实时处理音频帧。它展示了高级功能，包括用于实时数据处理的音频帧回调和手动播放控制。

## 功能特性
- **按钮控制录音**：通过按钮按下启动/停止录音
- **实时音频处理**：在录音期间监控音频电平并处理音频帧
- **自动回放**：录音停止后自动播放录制的音频
- **音频统计**：跟踪录音指标，包括帧数、数据大小和音频电平
- **支持语音活动检测**：帧回调可用于实现VAD

## 硬件要求
- 支持音频功能的涂鸦开发板
- 连接到音频输入的麦克风
- 连接扬声器或音频输出设备
- 连接到 GPIO 引脚 12 的按钮（可配置）

## 按钮控制
- **按住不放**：开始录音
- **松开**：停止录音并自动播放录制的音频
- **双击**：停止音频播放

## 使用说明

1. **上传程序**到您的涂鸦开发板
2. **打开串口监视器**，波特率设置为 115200 以查看调试信息
3. **按住按钮**开始录音（最多 5 秒）
4. **松开按钮**停止录音 - 播放将自动开始
5. **双击按钮**可随时停止播放
6. **监控串口输出**以查看录音统计和音频电平

## 代码功能要点

### 1. 音频帧回调
示例展示了使用 `setAudioFrameCallback()` 进行实时音频处理：
```cpp
void onAudioFrame(uint8_t* data, uint32_t len) {
  // 实时处理每个音频帧
  // 计算音频电平、流式传输到服务器等
}
```

**使用场景：**
- 将音频流式传输到云服务进行语音识别
- 实时音频电平监控和可视化
- 语音活动检测（VAD）
- 实时音频效果和滤波

### 2. 基于按钮的控制
使用按钮库进行防抖动的事件驱动控制：
- `BUTTON_EVENT_PRESS_DOWN`：开始录音
- `BUTTON_EVENT_PRESS_UP`：停止录音并触发播放
- `BUTTON_EVENT_DOUBLE_CLICK`：停止播放

### 3. 手动播放
演示使用 `play()` 接口逐帧播放：
```cpp
audio.play(play_buffer, out_len);
```

### 4. 音频统计
跟踪并显示：
- 录制的总帧数
- 捕获的总字节数
- 检测到的最大音频电平

## 音频配置
示例使用以下音频设置（可自定义）：
- **持续时间**：最多 5 秒录音时间
- **音量**：70% 播放音量
- **采样率**：16kHz
- **格式**：PCM 16位单声道
- **帧大小**：每个播放帧 640 字节

## 技术细节

### 音频数据流程
1. 按下按钮触发开始录音
2. 捕获音频帧，并为每个帧调用回调函数
3. 帧自动保存到内部环形缓冲区
4. 松开按钮停止录音
5. 逐帧读取录制的数据并播放
6. 播放后清除音频缓冲区

### 内存管理
- 动态播放缓冲区分配（640 字节）
- 录制音频的环形缓冲区（由音频库管理）
- 播放后自动清理

## 故障排除

**未录制到音频：**
- 检查麦克风连接
- 验证按钮连接到正确的 GPIO 引脚
- 检查串口监视器的错误消息

**播放不工作：**
- 验证扬声器/音频输出是否已连接
- 检查音量设置（默认 70%）
- 确保板支持音频播放

**按钮无响应：**
- 验证按钮连接到 GPIO 12
- 检查按钮上拉/下拉配置
- 查看串口监视器的按钮事件日志

## 示例输出
```
========================================
Audio Recorder with Frame Callback Demo
Project name:        audio_recorder
...
========================================
Button initialized on pin 12
Audio initialized successfully
Ready for recording...

=== Recording Started ===
Recording: 1280 bytes, frames: 10
Recording: 2560 bytes, frames: 20
=== Recording Stopped ===
===== Audio Statistics =====
Total frames: 38
Total bytes: 4864
Max audio level: 2847
============================
Starting playback using play() interface...
Playback completed, played 38 frames
Ready for next recording...
```

## 相关示例
- 简单音频录制：查看基本音频录制示例
- 音频流式传输：查看通过网络流式传输音频的示例

