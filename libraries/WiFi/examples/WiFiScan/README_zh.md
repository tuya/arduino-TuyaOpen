# WiFi 扫描示例

## 概述

本示例演示如何扫描附近的可用 WiFi 网络。它执行定期扫描并显示有关每个检测到的网络的详细信息，包括 SSID、信号强度（RSSI）、信道和加密类型。这对于网络发现、站点调查和选择最佳连接网络非常有用。

## 功能特性

- **网络发现**：扫描范围内的所有可用 WiFi 网络
- **详细信息**：显示 SSID、RSSI、信道和加密类型
- **定期扫描**：定期连续扫描
- **加密检测**：识别安全协议（开放、WEP、WPA、WPA2、WPA3）
- **内存管理**：正确清理扫描结果以释放内存

## 硬件要求

- 支持 WiFi 功能的 Tuya Open 开发板
- 用于编程和串口监视的 USB 数据线

## 配置说明

本示例不需要 WiFi 凭据。程序在站点模式下运行但不连接到任何网络。

## 工作原理

### 扫描过程

1. **WiFi 初始化**：将 WiFi 设置为站点模式但不连接
2. **网络扫描**：调用 `WiFi.scanNetworks()` 扫描可用网络
3. **结果处理**：遍历扫描结果并显示信息
4. **内存清理**：删除扫描结果以释放内存
5. **重复**：等待 5 秒后再次扫描

### WiFi 模式

```cpp
WiFi.mode(WIFI_STA);    // 设置为站点模式
WiFi.disconnect();       // 确保未连接
```

### 扫描

```cpp
int n = WiFi.scanNetworks();
```

此函数：
- 阻塞直到扫描完成
- 返回找到的网络数量
- 如果未找到网络则返回 0
- 通过 WiFi.SSID()、WiFi.RSSI() 等访问结果

### 网络信息访问

对于找到的每个网络：

```cpp
WiFi.SSID(i)           // 网络名称
WiFi.RSSI(i)           // 信号强度（dBm）
WiFi.channel(i)        // WiFi 信道（1-14）
WiFi.encryptionType(i) // 安全协议
```

### 内存管理

```cpp
WiFi.scanDelete();  // 释放扫描结果使用的内存
```

## 使用方法

1. **上传程序**：上传到你的 Tuya Open 开发板
2. **打开串口监视器**：设置波特率为 115200
3. **观察扫描**：每 5 秒查看发现的网络

### 预期输出

```
Setup done
Scan start
Scan done
5 networks found
Nr | SSID                             | RSSI | CH | Encryption
1  | 		HomeNetwork		 | 	-45		 | 	6		 | 	WPA2 PSK
2  | 		OfficeWiFi		 | 	-52		 | 	11		 | 	WPA + WPA2
3  | 		GuestNetwork		 | 	-67		 | 	1		 | 	WPA2 PSK
4  | 		PublicHotspot		 | 	-75		 | 	6		 | 	open
5  | 		Neighbor_2.4G		 | 	-82		 | 	3		 | 	WPA2 PSK

Scan start
...
```

## 理解输出

### RSSI（信号强度）

| RSSI 范围 | 质量 | 描述 |
|----------|-----|------|
| -30 到 -50 dBm | 优秀 | 非常强的信号 |
| -50 到 -60 dBm | 良好 | 强信号，可靠连接 |
| -60 到 -70 dBm | 一般 | 可接受，可能有问题 |
| -70 到 -80 dBm | 弱 | 连接质量差 |
| -80 到 -90 dBm | 非常弱 | 不稳定，频繁掉线 |
| 低于 -90 dBm | 不可用 | 太弱无法维持连接 |

### WiFi 信道

**2.4 GHz 频段：**
- 信道 1-14（信道 14 仅限日本）
- 非重叠信道：1、6、11
- 信道宽度：20 MHz 或 40 MHz

**5 GHz 频段：**
- 信道因地区而异
- 更多非重叠信道可用
- 干扰更少

### 加密类型

示例识别这些安全协议：

- **WAAM_OPEN**：无加密（公共网络）
- **WAAM_WEP**：WEP（过时，不安全）
- **WAAM_WPA_PSK**：WPA 预共享密钥
- **WAAM_WPA2_PSK**：WPA2（最常见）
- **WAAM_WPA_WPA2_PSK**：混合 WPA/WPA2
- **WAAM_WPA_WPA3_SAE**：WPA3（最新，最安全）
- **unknown**：未识别的加密

## 应用场景

- **网络发现**：查找可用的 WiFi 网络
- **站点调查**：评估区域内的 WiFi 覆盖
- **信道分析**：识别拥塞的信道
- **信号映射**：创建信号强度地图
- **最佳 AP 选择**：选择信号最强的网络连接
- **网络监控**：跟踪附近网络变化
- **安全审计**：识别不安全的网络（开放、WEP）
- **干扰检测**：查找重叠的信道

## 高级用法

### 异步扫描

对于非阻塞扫描，使用异步模式：

```cpp
WiFi.scanNetworks(true);  // true = 异步模式

// 检查扫描是否完成
int n = WiFi.scanComplete();
if (n >= 0) {
    // 扫描完成，n = 网络数量
}
```

### 隐藏网络检测

```cpp
// 也扫描隐藏网络
int n = WiFi.scanNetworks(false, true);  // false=同步，true=显示隐藏
```

### 过滤结果

```cpp
// 只显示信号良好的网络
for (int i = 0; i < n; ++i) {
    if (WiFi.RSSI(i) > -70) {
        Serial.println(WiFi.SSID(i));
    }
}
```

### 信道占用分析

```cpp
int channelCount[14] = {0};
for (int i = 0; i < n; ++i) {
    int ch = WiFi.channel(i);
    if (ch >= 1 && ch <= 14) {
        channelCount[ch - 1]++;
    }
}
// 找到最不拥塞的信道
```

## 故障排除

### 未找到网络

- 验证 WiFi 天线是否正确连接
- 检查你所在区域是否启用 WiFi
- 确保开发板未在金属外壳中（屏蔽射频）
- 尝试移动到不同位置

### 扫描时间长

- 正常扫描持续时间：每个信道 1-3 秒
- 扫描所有信道需要更长时间
- 无法显著加快（硬件限制）

### 网络列表不完整

- 某些网络可能是隐藏的（不广播 SSID）
- 5 GHz 频段的网络不会出现（如果开发板仅支持 2.4 GHz）
- 可能检测不到非常弱的信号

### 重复网络

- 具有多个 AP 的相同 SSID 会多次出现
- 每个条目代表不同的物理接入点
- 检查 MAC 地址（BSSID）以区分

### RSSI 波动

- 信号强度因干扰、移动等而变化
- 平均多次读数以获得准确测量
- 考虑环境因素（墙壁、物体、人）

## 性能考虑

### 扫描频率

- 不要扫描太频繁（造成 WiFi 开销）
- 建议最小间隔：5 秒
- 扫描会阻止正常的 WiFi 通信

### 内存使用

- 每个扫描结果使用内存
- 处理后始终调用 `WiFi.scanDelete()`
- 如果内存受限，限制扫描结果

### 功耗

- 扫描消耗大量电力
- 对于电池供电设备，考虑更长的间隔
- 使用异步扫描允许其他任务

## 注意事项

- 扫描无需连接到任何网络即可工作
- 扫描需要站点模式
- 扫描结果在下次扫描或删除之前有效
- 示例在循环中无限扫描
- RSSI 值始终为负（越接近 0 = 越强）
- 信道编号因国家/地区而异

## 相关示例

- WiFiMulti - 自动连接到信号最强的网络
- WiFiScanDualAntenna - 支持双天线扫描
- WiFiClient - 连接到特定网络
- WiFiClientEvents - 监控 WiFi 事件
